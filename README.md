# Helpus
  도와주고, 도움받는 따뜻한 세상 누구나, 언제든지 따뜻한 손길이 필요할 때
  
  
![스크린샷 2023-02-02 오후 1 46 51](https://user-images.githubusercontent.com/105340187/216734429-a1e61949-a6a5-4589-90cf-7683fd0a42be.png)

<a href="https://www.helpus.shop/">Helpus 링크</a>

<a href="https://github.com/Project-Helpus/Helpus.git">FE github</a>


### 💡 주요 기능
- 게시글 CRUD
- 내 위치 기반 게시글 검색
- 게시글 작성자와 채팅하기
- 채팅 알림
- 문의한 유저에게 초대장 전송
- 게시글 신고하기

### 🗺️ 프로젝트 아키텍처
![스크린샷 2023-02-10 오전 10 10 13](https://user-images.githubusercontent.com/105340187/217974971-c75b097a-e919-4e90-b761-bc514fa2dd45.png)



### ⚒️ ERD
![스크린샷 2023-02-10 오전 10 12 09](https://user-images.githubusercontent.com/105340187/217975174-1e53e567-7372-4bc1-aa69-abbf0a2bb602.png)


### ⚙️ 기술 스택
<div>
<img src="https://img.shields.io/badge/Node.js-339933?style=for-the-badge&amp;logo=Node.js&amp;logoColor=white" style="max-width: 100%;">
<img src="https://camo.githubusercontent.com/9bedb7507d80b68e39bdfaf3eb091c45ce6dc0bc605f8ffc3e80daf5e5c0dfce/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f547970655363726970742d626c75653f7374796c653d666f722d7468652d6261646765266c6f676f3d74797065736372697074266c6f676f436f6c6f723d7768697465" data-canonical-src="https://img.shields.io/badge/TypeScript-blue?style=for-the-badge&amp;logo=typescript&amp;logoColor=white">
<img src="https://img.shields.io/badge/Express-000000?style=for-the-badge&amp;logo=Express&amp;logoColor=white" style="max-width: 100%;">
<img src="https://img.shields.io/badge/npm-CB3837?style=for-the-badge&amp;logo=npm&amp;logoColor=white" style="max-width: 100%;">
<img src="https://camo.githubusercontent.com/098beeb15eabe4f7e17a28649e9a30b754309cdf22e2b63314f32c44a83fba2c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f736f636b6574696f2d626c61636b3f7374796c653d666f722d7468652d6261646765266c6f676f3d736f636b65742e696f266c6f676f436f6c6f723d7768697465" data-canonical-src="https://img.shields.io/badge/socketio-black?style=for-the-badge&amp;logo=socket.io&amp;logoColor=white">
</div>
<div>
<img src="https://camo.githubusercontent.com/18deb1d9701530bd13a8f64c45eec55eec952345c2577bae39d8b94feeaa2eae/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4e67696e782d3030393633392e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d4e67696e78266c6f676f436f6c6f723d7768697465" alt="Nginx">
<img src="https://img.shields.io/badge/Let's Encrypt-003A70?style=for-the-badge&amp;logo=Let's Encrypt&amp;logoColor=white" style="max-width: 100%;">
<img src="https://camo.githubusercontent.com/ddab8aa8df1faefb7c1355ac6379d70a62e938b68f30bc4eb6e4e5219b78fae6/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f504d322d3242303337413f7374796c653d666f722d7468652d6261646765266c6f676f3d706d32266c6f676f436f6c6f723d7768697465" alt="PM2">
<img src="https://camo.githubusercontent.com/fd012c7b175308b8b419e62110e7b964e351130ae6e10eb9b7b296d5fde03d60/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4157532532304543322d2532334646393930302e7376673f7374796c653d666f722d7468652d6261646765266c6f676f3d616d617a6f6e2d656332266c6f676f436f6c6f723d626c61636b" alt="AWS EC2">
<img src="https://camo.githubusercontent.com/deb35fe4749fc9b312bc25c34cb8d971fc7b919d1bfa8f15b44e01d1fb4ffd8b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f476974687562253230416374696f6e732d3230383846463f7374796c653d666f722d7468652d6261646765266c6f676f3d676974687562616374696f6e73266c6f676f436f6c6f723d7768697465" alt="Github Actions">
</div>

<div>
<img src="https://img.shields.io/badge/Winston-231F20?style=for-the-badge&amp;logo=winston&amp;logoColor=white">
<img src="https://img.shields.io/badge/Morgan-2D3748?style=for-the-badge&logo=Morgan&logoColor=white">

</div>
<div>
  <img src="https://img.shields.io/badge/prisma-2D3748?style=for-the-badge&logo=#Prisma&logoColor=white">
  <img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=#MySQL&logoColor=white">
  <img src="https://img.shields.io/badge/Amazon S3-569A31?style=for-the-badge&logo=#Amazon S3&logoColor=white">
  <img src="https://img.shields.io/badge/Amazon RDS-527FFF?style=for-the-badge&amp;logo=Amazon RDS&amp;logoColor=white">


</div>

### 🖋️ 기술적 의사결정
- JavaScript vs TypeScript

       ❓ 도입이유     
        - 자바스크립트에 비해 명확한 에러 메시지와 에러 핸들링으로 인한 버그 방지 및 개발 시간 감축
        - esLint 와 함께 사용함으로써 에러 가능성을 사전 차단
        
        ⚠️ 문제상황
        - 필수 속성에 undefinded, null 등의 값일 때에도 에러를 발생하지 않는 등 추상적인 버그가 많아 불필요한 시간 소요가 많음
        - 자바스크립트 ORM 인 시퀄라이즈의 쿼리 성능이 낮음
        - 타입스크립트의 이해도가 낮은 상태에서 사용하면 자바스크립트를 사용하는 것과 큰 차이가 없고, 코드량이 많이짐
        - 배포 전 빌드가 필요해 번거로움
        
        ⚒️ 해결방안
        - MVP 중간발표 전까지는 타입 지정만 사용하여 개발하고 발표 후 리팩토링을 통해 인터페이스, 클래스 활용 등을 도입
        
        🔧 의견조율
        - 타입스크립트를 사용하지만 클래스와 인터페이스 등에 대한 숙련도가 부족하여 상대적으로 익숙한 자바스크립트를 사용하자는 의견
        - 자바스크립트를 사용하면 런타임 시 생기는 버그를 찾느라 시간이 많이 소요되기 때문에 컴파일 시 버그를 차단할 수 있는 타입스크립트를 사용하자는 의견


        📌 의견 결정
        - 타입스크립트와 사용하면서 에러로 인한 개발시간을 단축시키고 개발 코스트를 감소시키기 위해 타입스크립트로 결정


- DB, ORM

       ❓ 도입이유 
        - MySQL : 게시판 특성상 유저와 게시글 사이의 관계형성이 중요한 만큼 관계형 데이터베이스 사용

        - Prisma :Sequelize에 비해 직관적인 모델 스키마와 데이터베이스를 설계할 때 제공되는 자동완성 기능으로 생산성 향상
                  다른 ORM 에 비해 공식문서가 상대적으로 자세히 나와 있어 원하는 기능을 정확하게 사용할 수 있음

        ⚠️ 문제상황
        - 이미지나 태그 등 여러개의 데이터를 하나의 필드에 추가해야 할 때 MySQL은 배열 데이터 타입을 지원하지 않음

        ⚒️ 해결방안
        - 테이블 관계설정을 통해 여러 데이터를 하나의 테이블에 종속시켜 데이터를 가져오는 방식을 사용

        🔧 의견조율
        - 배열을 데이터로 입력할 수 있는 PostgreSQL 사용하자는 의견
        - 이미 MySQL 로 개발이 상당 부분 진행된 상태였고, 배열을 필요로하는 필드 하나 때문에 DB를 변경하고 마이그레이션을 하는 것은
          합리적이지 못하므로, 관계설정을 통해 배열 삽입의 문제를 극복할 수 있을 것으로 판단함


        📌 의견 결정
        - 이미 개발이 진행된 MySQL 을 그대로 사용하고 테이블 관계설정과 쿼리문을 적절히 사용하기로 결정
   
   
- CI/CD

       ❓ 도입이유 
        - 개발 중후반 단계에서, 타입스크립트 코드를 빌드하고 배포하는 과정에서 소요되는 시간이 많아 배포 자동화를 도입하기로 결정 
        
        ⚠️ 문제상황
        - 수정사항이 생길때마다 인스턴스에서 github 레퍼지토리를 pull 해오고, 빌드하고 재시작하는 단계가 이루어지면서 시간소요가 많음
        
        ⚒️ 해결방안
        - 깃허브 액션 또는 jenkins 중 하나를 선택해서 배포 자동화를 도입
        
        🔧 의견조율
        - github action 은 별도의 초기 설정이 필요 없고 github 에서 제공하는 클라우드를 사용해 쉽게 사용이 가능하고 모든 os 환경에서 호환이 가능함
        - 젠킨스는 깃허브 이외에 다양한 버전 관리 툴에서 사용 가능하지만 초기 설정이 복잡하고 젠킨스 사용을 위한 서버가 따로 있어야 하는 문제가 있음
        
        📌 의견 결정
        - 개발 초반에서 도입하는 것이 아닌 만큼 빠르게 적용할 수 있고 도입이 비교적 간편한 깃허브 액션을 선택
        

### ⚠️ 트러블 슈팅

- 게시글 이미지

      💡  문제
      - 게시글 이미지 작성 시 게시글을 생성하는 api 에서 이미지 URL 을 포함해서 게시글을 생성하는데, 
        mySQL 에는 여러 이미지를 넣기 위해 배열을 사용할 수 없기 때문에 imageUrl1, imageUrl2, imageUrl3 필드를 추가해 
        3장의 이미지만 넣을 수 있게 제한해두었음
      - 이미지를 추가하지 않는 경우 의미없이 비어있는 필드가 많아지게 됨

      💡 고민했던 내용
      - 이미지를 3장만 업로드할 수 있으면 유저 자유도 면에서 불편함이 생길 것으로 생각됨
      - 현재까지의 방식대로라면 이미지의 최대 개수가 많을 수록 이미지 필드가 많아져 깔끔하지 않을것으로 생각됨


      💡 해결방안
      - 게시글 이미지만 취급하는 테이블을 새로 만들고 게시글 테이블과 관계를 줘서 최대 10장까지 이미지를 올릴 수 있게 함
      - 게시글 디자인과 DB 안정성을 위해 10장의 제한을 두었음


- 배포 서버와 테스트 서버   

      💡  문제
      - 초기 단계에선 서버를 나눠야 하는 이유를 생각하지 못하고 하나의 서버와 데이터베이스를를 가지고 FE/BE 가 개발을 했음
      - 개발 과정에서 생기는 mock 데이터가 배포된 서버에 그대로 노출되게 되는 문제가 발생함
      - 하나의 서버를 사용할 경우 애플리케이션에 오류가 생기면 백엔드에서 오류 수정이 끝날 때 까지 서버를 멈춰야 하는 문제가 발생함

      💡 해결방안
      - 별도의 인스턴스를 새로 만들어 배포 서버와 테스트 서버를 분리함
      - 깃허브의 master 브랜치는 배포 서버, Develop 브랜치는 테스트 서버와 연동함
      - 데이터베이스는 helpus 스키마와 helpus_test 스키마를 분리해 개발 단계에서 생성되는 데이터를 배포 서버에서 나타나지 않게 함


- 배포 자동화
    
      💡 문제
      - 배포 서버와 테스트 서버를 따로 운영하다보니, 변경 사항이 생겼을 때 두 개의 서버에 각각 적용해야 하는 점이 효율적이지 못하다고 생각됨
      - 테스트 서버의 경우에는 잦은 변화가 일어나는 만큼 더더욱 서버에 코드가 변경되는 일이 잦은데, 이를 매번 수동으로 작업하는 것에 피로감을 느낌
    
      💡 해결방안
      - 배포 자동화 툴이 있다는 것을 알게 되었고 이를 적용하기로 결정함
      - 젠킨스와 깃허브 액션 중에서, 프로젝트 초반이 아닌 중후반에 적용하는 만큼 설정이 어렵지 않고 빠르게 도입할 수 있는 기술을 선택하고자 하였음
      - 젠킨스는 다양한 버전 관리 툴에서 사용할 수 있지만, 서버를 따로 두어야하고 초기 설정이 복잡하다는 단점이 있음
      - 깃허브 액션의 경우에는 private repository의 경우 유료이지만 설정이 크게 필요 없고 .yml 파일 작성만으로 적용할 수 있다는 장점이 있음
      - 금번 프로젝트의 경우 public repository를 사용하고 있고 빠른 적용을 원했기 때문에 깃허브 액션이 적합하다고 판단하여 이를 적용함

    
- 리프레시 토큰의 저장 위치

      💡  문제
      - 토큰 탈취의 위험부담 때문에 액세스 토큰의 유효시간을 길게 줄 수 없었고, 그렇다고 짧게 설정하자니 유저의 불편함을 해결하기 어려웠음
      - 이러한 이유로 리프레시 토큰을 도입하기로 함
      - 그런데 도입한 리프레시 토큰을 서버에 저장하자니, 클라이언트가 본인임을 확인시키기 어려움이 있음
      - 그렇다고 클라이언트가 가지고 있게 하자니 액세스 토큰과 마찬가지로 탈취의 위험이 있었음

      💡 해결방안
      - 쿠키에 HttpOnly 와 sameSite 를 설정해 통신을 할 경우에만 쿠키가 오고 가도록 하고, 발급한 도메인이 아닌 경우 
        전송되지 않도록 설정하여 보안 위협을 최소화 함
      - 액세스 토큰의 재발급이 필요한 경우 서버 측에 저장된 리프레시 토큰과 클라이언트 측에서 전송한 리프레시 토큰을 
        비교해서, 일치하는 경우에만 인가하는 방식을 채택

### 💌 유저 피드백 개선
### 😎 Helpus 팀원
<table>
  <thead>
    <tr>
      <th>
        나지원
      </th>
      <th>
        최지호
      </th>
      <th>
        최한울
      </th>
      <th>
        권애경
      </th>
      <th>
        김수현
      </th>
    <tr>
  </thead>
  <tbody>
    <td><a href="https://github.com/nacjji">BE</a></td>
    <td><a href="https://github.com/minaliokng">BE</a></td>
    <td><a href="https://github.com/hanul-dev">FE</a></td>
    <td><a href="https://github.com/buddesign">FE</a></td>
    <td><a href="https://github.com/deasaungkim">FE</a></td>
  </tbody>
</table>
